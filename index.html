<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Whale Migration & Observation Guide</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="description" content="Explore whale migration patterns, species diversity, and discover the best whale watching locations worldwide.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <!-- Animation Toggle: Set to true for 3D model, false for video animation -->
    <script>
        const USE_3D_ANIMATION = false;
    </script>

    <!-- Three.js for whale animation (only loaded if USE_3D_ANIMATION is true) -->
    <script>
        if (USE_3D_ANIMATION) {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"><\/script>');
            document.write('<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"><\/script>');
            document.write('<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"><\/script>');
            document.write('<script src="whale-scene.js"><\/script>');
        }
    </script>
    <style>
        /* ============================================================
           NAVBAR STYLES (matching species.html and density-map.html)
           ============================================================ */
        :root {
            --nav-height: 72px;
        }

        #navbar {
            z-index: 1000;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            height: var(--nav-height);
            display: flex;
            align-items: center;
        }

        #navbar .nav-container {
            padding: 8px 14px;
            gap: 12px;
            flex-wrap: nowrap;
            height: 100%;
            width: 100%;
            max-width: none;
            margin: 0;
        }

        #navbar .nav-brand {
            padding: 8px 0;
            gap: 8px;
            font-size: 18px;
            margin-right: auto;
        }

        #navbar .nav-links {
            gap: 6px;
            flex-wrap: nowrap;
        }

        #navbar .nav-link {
            padding: 8px 12px;
            font-size: 13px;
            white-space: nowrap;
        }

        /* Hamburger toggle (shown on mobile) */
        #navbar .nav-toggle {
            display: none;
            width: 38px;
            height: 38px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.1);
            color: #fff;
            align-items: center;
            justify-content: center;
            gap: 6px;
            flex-direction: column;
            cursor: pointer;
        }

        #navbar .nav-toggle span {
            display: block;
            width: 18px;
            height: 2px;
            background: currentColor;
            border-radius: 4px;
        }

        /* Mobile nav behavior */
        @media (max-width: 900px) {
            #navbar .nav-container {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            #navbar .nav-links {
                display: none;
                position: absolute;
                top: var(--nav-height);
                left: 0;
                right: 0;
                padding: 12px 16px;
                background: rgba(10, 35, 66, 0.96);
                flex-direction: column;
                gap: 8px;
                box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
            }

            #navbar.nav-open .nav-links {
                display: flex;
            }

            #navbar .nav-toggle {
                display: inline-flex;
            }

            #navbar .nav-links .nav-link {
                width: 100%;
                text-align: left;
            }
        }

        /* Make sure map can host absolutely positioned children (panel, controls, etc.) */
        #map {
            position: relative;
        }
        
        /* CIRCULAR MONTH CONTROLS - Force absolute positioning */
        #controls {
            position: absolute !important;
            bottom: 30px !important;
            left: 30px !important;
            top: auto !important;
            right: auto !important;
            z-index: 10 !important;
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            width: auto !important;
            max-width: 220px;
        }
        
        /* ANIMATION SETTINGS DROPDOWN PANEL */
        .settings-panel {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 10;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .settings-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
            font-size: 13px;
            font-weight: 600;
            color: #333;
            transition: all 0.2s ease;
        }
        
        .settings-toggle:hover {
            background: #fff;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .settings-toggle svg {
            width: 18px;
            height: 18px;
            transition: transform 0.3s ease;
        }
        
        .settings-panel.open .settings-toggle svg {
            transform: rotate(90deg);
        }
        
        .settings-toggle .chevron {
            width: 14px;
            height: 14px;
            margin-left: auto;
            transition: transform 0.3s ease;
        }
        
        .settings-panel.open .settings-toggle .chevron {
            transform: rotate(180deg);
        }
        
        .settings-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            width: 280px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.18);
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .settings-panel.open .settings-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .settings-header {
            padding: 14px 18px;
            border-bottom: 1px solid #eee;
            font-size: 12px;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .settings-content {
            padding: 16px 18px;
        }
        
        .setting-group {
            margin-bottom: 18px;
        }
        
        .setting-group:last-child {
            margin-bottom: 0;
        }
        
        .setting-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .setting-label span {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }
        
        .setting-value {
            font-size: 12px;
            font-weight: 600;
            color: #2c7ab8;
            background: #e3f2fd;
            padding: 3px 10px;
            border-radius: 12px;
        }
        
        .setting-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, #2c7ab8 0%, #e0e0e0 0%);
            outline: none;
            cursor: pointer;
        }
        
        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #2c7ab8;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }
        
        .setting-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(44, 122, 184, 0.3);
        }
        
        .setting-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid #2c7ab8;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        
        .setting-description {
            font-size: 11px;
            color: #888;
            margin-top: 8px;
            line-height: 1.4;
        }
        
        .setting-presets {
            display: flex;
            gap: 6px;
            margin-top: 10px;
        }
        
        .preset-btn {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            font-size: 11px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .preset-btn:hover {
            border-color: #2c7ab8;
            color: #2c7ab8;
            background: #f0f7ff;
        }
        
        .preset-btn.active {
            border-color: #2c7ab8;
            background: #2c7ab8;
            color: #fff;
        }
        
        .settings-divider {
            height: 1px;
            background: #eee;
            margin: 16px 0;
        }
        
        .reset-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: #f5f5f5;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .reset-btn:hover {
            background: #e74c3c;
            color: #fff;
        }
        
        /* Colormap grid styles */
        .colormap-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .colormap-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 6px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .colormap-btn:hover {
            border-color: #2c7ab8;
            transform: translateY(-1px);
        }
        
        .colormap-btn.active {
            border-color: #2c7ab8;
            background: #f0f7ff;
            box-shadow: 0 2px 8px rgba(44, 122, 184, 0.2);
        }
        
        .colormap-preview {
            width: 100%;
            height: 12px;
            border-radius: 4px;
            margin-bottom: 4px;
        }
        
        .colormap-btn span {
            font-size: 9px;
            font-weight: 600;
            color: #666;
        }
        
        .colormap-btn.active span {
            color: #2c7ab8;
        }
        
        /* ============================================================
           RESPONSIVE STYLES FOR MOBILE AND NARROW SCREENS
           ============================================================ */
        
        /* Tablet and smaller */
        @media (max-width: 768px) {
            #controls {
                bottom: 20px !important;
                left: 20px !important;
                padding: 12px !important;
                border-radius: 16px !important;
                max-width: 180px !important;
            }
            
            .control-header {
                font-size: 10px;
                margin-bottom: 8px;
            }
            
            .circular-selector {
                width: 140px;
                height: 140px;
            }
            
            .month-marker {
                width: 28px;
                height: 28px;
                font-size: 8px;
            }
            
            .center-display {
                width: 70px;
                height: 70px;
            }
            
            .center-month {
                font-size: 11px;
            }
            
            .center-hint {
                font-size: 7px;
            }
            
            .nav-arrows {
                gap: 8px;
                margin-top: 8px;
            }
            
            .nav-arrow {
                width: 28px;
                height: 28px;
            }
            
            .nav-arrow svg {
                width: 14px;
                height: 14px;
            }
            
            .play-controls {
                margin-top: 10px;
            }
            
            .control-button {
                padding: 6px 16px;
                font-size: 11px;
            }
            
            #legend {
                max-width: 120px !important;
                padding: 8px !important;
                bottom: 30px !important;
            }
            
            .legend-title {
                font-size: 10px;
            }
            
            .legend-note {
                font-size: 9px;
            }
            
            #monthBottom {
                font-size: 14px !important;
                padding: 6px 14px !important;
            }
            
            .settings-panel {
                top: 10px;
                right: 10px;
            }
            
            .settings-toggle {
                padding: 8px 12px;
                font-size: 11px;
            }
            
            .settings-toggle span {
                display: none;
            }
            
            .settings-toggle svg:first-child {
                width: 16px;
                height: 16px;
            }
            
            .settings-toggle .chevron {
                display: none;
            }
            
            .settings-dropdown {
                width: 240px;
            }
            
            /* Info panel adjustments */
            .info-panel {
                width: 320px;
                max-width: 85vw;
            }
        }
        
        /* Mobile phones */
        @media (max-width: 480px) {
            #controls {
                bottom: 12px !important;
                left: 12px !important;
                padding: 10px !important;
                border-radius: 14px !important;
                max-width: 150px !important;
            }
            
            .control-header {
                font-size: 9px;
                margin-bottom: 6px;
            }
            
            .circular-selector {
                width: 105px;
                height: 105px;
            }
            
            .month-marker {
                width: 22px;
                height: 22px;
                font-size: 7px;
            }
            
            .center-display {
                width: 52px;
                height: 52px;
            }
            
            .center-month {
                font-size: 9px;
            }
            
            .center-hint {
                font-size: 6px;
            }
            
            .rotation-indicator {
                display: none;
            }
            
            .nav-arrows {
                gap: 6px;
                margin-top: 6px;
            }
            
            .nav-arrow {
                width: 24px;
                height: 24px;
            }
            
            .nav-arrow svg {
                width: 12px;
                height: 12px;
            }
            
            .play-controls {
                margin-top: 8px;
            }
            
            .control-button {
                padding: 5px 12px;
                font-size: 10px;
                border-radius: 14px;
            }
            
            #legend {
                max-width: 100px !important;
                padding: 6px !important;
                bottom: 12px !important;
                right: 12px !important;
            }
            
            .legend-title {
                font-size: 9px;
                margin-bottom: 4px;
            }
            
            .gradient-bar {
                height: 8px;
            }
            
            .gradient-labels {
                font-size: 8px;
            }
            
            .legend-note {
                font-size: 8px;
                margin-top: 4px;
            }
            
            #monthBottom {
                font-size: 11px !important;
                padding: 4px 10px !important;
                bottom: 12px !important;
            }
            
            .settings-panel {
                top: 8px;
                right: 8px;
            }
            
            .settings-toggle {
                padding: 6px 10px;
            }
            
            .settings-dropdown {
                width: 200px;
                right: 0;
            }
            
            .settings-header {
                padding: 10px 12px;
                font-size: 10px;
            }
            
            .settings-content {
                padding: 10px 12px;
            }
            
            .setting-label span {
                font-size: 11px;
            }
            
            .setting-value {
                font-size: 10px;
                padding: 2px 6px;
            }
            
            .setting-description {
                font-size: 9px;
            }
            
            .setting-presets {
                gap: 4px;
            }
            
            .preset-btn {
                padding: 5px 6px;
                font-size: 9px;
            }
            
            .colormap-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
            }
            
            .colormap-btn {
                padding: 5px 3px;
            }
            
            .colormap-preview {
                height: 8px;
            }
            
            .colormap-btn span {
                font-size: 7px;
            }
            
            .reset-btn {
                padding: 6px;
                font-size: 10px;
            }
            
            .settings-divider {
                margin: 10px 0;
            }
            
            /* Info panel adjustments */
            .info-panel {
                width: 100%;
                max-width: 100vw;
            }
        }
        
        /* Very small screens */
        @media (max-width: 360px) {
            #controls {
                bottom: 8px !important;
                left: 8px !important;
                padding: 8px !important;
                max-width: 130px !important;
            }
            
            .control-header {
                display: none;
            }
            
            .circular-selector {
                width: 90px;
                height: 90px;
            }
            
            .month-marker {
                width: 18px;
                height: 18px;
                font-size: 6px;
            }
            
            .center-display {
                width: 44px;
                height: 44px;
            }
            
            .center-month {
                font-size: 8px;
            }
            
            .center-hint {
                display: none;
            }
            
            .nav-arrows {
                gap: 4px;
                margin-top: 4px;
            }
            
            .nav-arrow {
                width: 22px;
                height: 22px;
            }
            
            .play-controls {
                margin-top: 6px;
            }
            
            .control-button {
                padding: 4px 10px;
                font-size: 9px;
            }
            
            #legend {
                display: none !important;
            }
            
            #monthBottom {
                font-size: 10px !important;
                padding: 3px 8px !important;
            }
        }
        
        /* Landscape mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            #controls {
                bottom: 8px !important;
                left: 8px !important;
                padding: 6px !important;
                max-width: 120px !important;
            }
            
            .control-header {
                display: none;
            }
            
            .circular-selector {
                width: 85px;
                height: 85px;
            }
            
            .month-marker {
                width: 18px;
                height: 18px;
                font-size: 6px;
            }
            
            .center-display {
                width: 42px;
                height: 42px;
            }
            
            .center-month {
                font-size: 8px;
            }
            
            .center-hint {
                display: none;
            }
            
            .rotation-indicator {
                display: none;
            }
            
            .nav-arrows {
                margin-top: 4px;
                gap: 4px;
            }
            
            .nav-arrow {
                width: 20px;
                height: 20px;
            }
            
            .play-controls {
                margin-top: 4px;
            }
            
            .control-button {
                padding: 3px 8px;
                font-size: 8px;
            }
            
            #legend {
                max-width: 90px !important;
                padding: 5px !important;
            }
            
            #monthBottom {
                font-size: 10px !important;
                padding: 3px 8px !important;
            }
        }
        
        /* CIRCULAR MONTH SELECTOR STYLES */
        #controls {
            position: absolute;
            bottom: 30px;
            left: 30px;
            z-index: 10;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 16px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .control-header {
            font-size: 11px;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .circular-selector {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto;
        }
        
        .month-wheel {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .month-marker {
            position: absolute;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
            user-select: none;
            z-index: 2;
        }
        
        .month-marker:hover {
            background: rgba(44, 122, 184, 0.15);
            color: #2c7ab8;
            transform: scale(1.1);
        }
        
        .month-marker.active {
            background: #2c7ab8;
            color: white;
            box-shadow: 0 2px 8px rgba(44, 122, 184, 0.4);
            transform: scale(1.15);
        }
        
        .center-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3;
        }
        
        .center-month {
            font-size: 14px;
            font-weight: 700;
            color: #2c7ab8;
            margin-bottom: 2px;
        }
        
        .center-hint {
            font-size: 8px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Rotation indicator line */
        .rotation-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, #2c7ab8 60%, #2c7ab8 100%);
            transform-origin: left center;
            z-index: 1;
            pointer-events: none;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .rotation-indicator::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: #2c7ab8;
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(44, 122, 184, 0.5);
        }
        
        /* Drag ring for rotation */
        .drag-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            cursor: grab;
            z-index: 4;
        }
        
        .drag-ring:active {
            cursor: grabbing;
        }
        
        .drag-ring::before {
            content: '';
            position: absolute;
            inset: 6px;
            border-radius: 50%;
            border: 2px dashed rgba(44, 122, 184, 0.2);
            pointer-events: none;
        }
        
        /* Play button below wheel */
        .play-controls {
            display: flex;
            justify-content: center;
            margin-top: 14px;
            gap: 8px;
        }
        
        .control-button {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #2c7ab8;
            color: white;
        }
        
        .control-button:hover {
            background: #1e5a8a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(44, 122, 184, 0.3);
        }
        
        .control-button.playing {
            background: #e74c3c;
        }
        
        .control-button.playing:hover {
            background: #c0392b;
        }
        
        /* Navigation arrows */
        .nav-arrows {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 10px;
        }
        
        .nav-arrow {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: #f0f0f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            color: #666;
        }
        
        .nav-arrow:hover {
            background: #2c7ab8;
            color: white;
        }
        
        .nav-arrow svg {
            width: 16px;
            height: 16px;
        }
        
        /* Hide the old slider */
        #monthSlider {
            display: none;
        }
        
        .month-display {
            display: none;
        }
        
        /* SIDE PANEL – overlays from right, map stays same size */
        .info-panel {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 400px;
            max-width: 90vw;
            background: #ffffff;
            box-shadow: -4px 0 18px rgba(0,0,0,0.18);
            display: flex;
            flex-direction: column;
            transform: translateX(calc(100% + 5px)); /* Extra 5px to ensure fully hidden */
            transition: transform 0.3s ease, visibility 0.3s ease;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            z-index: 15; /* Higher than settings panel (z-index: 10) */
            visibility: hidden; /* Hide when closed */
        }
        .info-panel.open {
            transform: translateX(0);
            visibility: visible;
        }
        .info-panel-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 10px 16px;
            border-bottom: 1px solid #eee;
            min-height: 50px;
        }
        .info-panel-title-group h3 {
            margin: 0;
            font-size: 18px;
        }
        .info-panel-title-group p {
            margin: 2px 0 0 0;
            font-size: 12px;
            color: #666;
        }
        
        /* Fold tab close button - top left corner */
        .info-panel-close-fold {
            position: absolute;
            top: 0;
            left: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #f0f0f0 50%, transparent 50%);
            border: none;
            cursor: pointer;
            z-index: 20;
            transition: all 0.2s ease;
        }
        
        .info-panel-close-fold::before {
            content: '×';
            position: absolute;
            top: 6px;
            left: 8px;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            line-height: 1;
            transition: all 0.2s ease;
        }
        
        .info-panel-close-fold:hover {
            background: linear-gradient(135deg, #e0e0e0 50%, transparent 50%);
        }
        
        .info-panel-close-fold:hover::before {
            color: #333;
        }
        
        /* Adjust header to account for fold */
        .info-panel-header {
            padding-left: 50px;
        }
        /* Body fills the rest of panel height and scrolls as needed */
        .info-panel-body {
            flex: 1;
            overflow-y: auto;
        }
        /* Full-width media header inside panel */
        .location-panel-header-media {
            position: relative;
            width: 100%;
            height: 180px;
            overflow: hidden;
        }
        .location-panel-header-media img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: opacity 0.3s ease;
        }
        /* Image carousel navigation for panel */
        .panel-image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 8px;
            pointer-events: none;
            z-index: 5;
        }
        
        .panel-image-nav.hidden {
            display: none;
        }
        
        .panel-nav-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
            transition: all 0.2s ease;
        }
        
        .panel-nav-btn:hover {
            background: rgba(0,0,0,0.7);
        }
        
        .panel-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .panel-image-counter {
            position: absolute;
            bottom: 50px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            z-index: 5;
        }
        
        .panel-image-counter.hidden {
            display: none;
        }
        .location-name-overlay-panel {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 24px 18px 10px;
            background: linear-gradient(transparent, rgba(0,0,0,0.85));
            color: #fff;
        }
        .location-name-overlay-panel .location-name {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .location-name-overlay-panel .location-region {
            font-size: 13px;
            margin: 4px 0 0 0;
            opacity: 0.95;
        }
        /* Main content uses full width of panel */
        .location-panel-content {
            padding: 18px;
        }
        .score-container {
            display: flex;
            gap: 16px;
            margin-bottom: 18px;
            justify-content: center;
        }
        .score-circle {
            text-align: center;
            position: relative;
            cursor: help;
        }
        
        .score-circle:hover .score-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        .score-tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            white-space: normal;
            max-width: 200px;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            margin-top: 8px;
            z-index: 10;
            pointer-events: none;
        }
        
        .score-tooltip::after {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-bottom-color: rgba(0, 0, 0, 0.9);
        }
        .circle-svg {
            width: 50px;
            height: 50px;
        }
        .circle-bg {
            fill: none;
            stroke: #f0f0f0;
            stroke-width: 5;
        }
        .circle-progress {
            fill: none;
            stroke-width: 5;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.6s ease;
            transform-origin: center;
            transform: rotate(-90deg);
        }
        .score-value {
            font-size: 14px;
            font-weight: 700;
            fill: #333;
        }
        .score-label {
            font-size: 10px;
            color: #666;
            margin-top: 4px;
            font-weight: 600;
        }
        .species-list {
            background: #f8f9fa;
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 14px;
        }
        .species-title {
            font-size: 11px;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 7px;
        }
        .species-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .species-tag {
            background: white;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            color: #2c7ab8;
            border: 1px solid #e0e0e0;
            font-weight: 500;
        }
        .info-section {
            margin-bottom: 14px;
        }
        .info-label {
            font-size: 10px;
            font-weight: 700;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }
        .info-text {
            font-size: 13px;
            color: #333;
            line-height: 1.5;
        }
        .best-months {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }
        .month-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 3px 7px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
        }
        .accessibility-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .excellent { background: #d4edda; color: #155724; }
        .good { background: #d1ecf1; color: #0c5460; }
        .moderate { background: #fff3cd; color: #856404; }
        /* Monthly density chart styles */
        .monthly-density-chart {
            background: #f8f9fa;
            padding: 14px;
            border-radius: 8px;
            margin-bottom: 14px;
        }
        
        .chart-title {
            font-size: 11px;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }
        
        .month-bars {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 80px;
            gap: 2px;
            padding: 0 4px;
        }
        
        .month-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }
        
        .bar-wrapper {
            flex: 1;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        
        .bar-fill {
            width: 100%;
            background: linear-gradient(to top, #2c7ab8, #4a9fd8);
            border-radius: 2px 2px 0 0;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .month-bar:hover .bar-fill {
            background: linear-gradient(to top, #1e5a8a, #2c7ab8);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .bar-label {
            font-size: 8px;
            color: #666;
            font-weight: 600;
            line-height: 1;
            margin-top: 3px;
            flex-shrink: 0;
        }
        /* Stacked species bar-specific styles */
        .stacked-bar {
            width: 100%;
            display: flex;
            flex-direction: column-reverse;
            border-radius: 2px 2px 0 0;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .species-segment {
            width: 100%;
        }
        
        .bar-count {
            font-size: 9px;
            color: #444;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .month-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 6px 8px;
            border-radius: 6px;
            font-size: 11px;
            min-width: 120px;
            max-width: 180px;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.15s ease;
            z-index: 20;
        }
        
        .month-bar {
            position: relative;
        }
        
        .month-bar:hover .month-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        .tooltip-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 11px;
        }
        
        .tooltip-species {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            margin-bottom: 2px;
        }
        
        .tooltip-color {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .species-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 10px;
            color: #555;
        }
        
        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 4px;
            border: 1px solid rgba(0,0,0,0.15);
        }
        /* Tourism stats section */
        .tourism-stats {
            background: #f0f7ff;
            padding: 12px;
            border-radius: 8px;
            margin-top: 14px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
        }
        
        .stat-label {
            font-size: 9px;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .stat-value {
            font-size: 13px;
            color: #1976d2;
            font-weight: 600;
        }
        /* Scrollbar styling inside panel content (optional) */
        .info-panel-body::-webkit-scrollbar {
            width: 6px;
        }
        .info-panel-body::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .info-panel-body::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }
        .info-panel-body::-webkit-scrollbar-thumb:hover {
            background: #aaa;
        }

        /* ============================================
           NAVIGATION CARDS - DESKTOP
           ============================================ */
        .nav-carousel-section {
            position: absolute;
            top: 73%;
            left: 0;
            right: 0;
            padding: 0 40px 120px;
            z-index: 20;
        }

        .nav-carousel-wrapper {
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Section header */
        .nav-section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .nav-section-title {
            font-size: 48px;
            font-weight: 700;
            color: #ffffff;
            margin: 0 0 12px 0;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-section-subtitle {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.85);
            margin: 0;
            font-weight: 400;
        }

        .nav-carousel {
            display: flex;
            align-items: stretch;
            gap: 24px;
            width: 100%;
        }

        /* Base card styles */
        .nav-card {
            flex: 1;
            min-height: 420px;
            background: rgba(10, 22, 40, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(126, 200, 227, 0.25);
            border-radius: 24px;
            text-decoration: none;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Active card (default expanded) - only when carousel NOT hovered */
        .nav-card.active {
            flex: 2.5;
            min-height: 480px;
            border-color: rgba(126, 200, 227, 0.7);
            box-shadow: 0 24px 70px rgba(0, 0, 0, 0.5), 0 0 50px rgba(126, 200, 227, 0.25);
            background: rgba(10, 22, 40, 0.98);
            transform: translateY(-10px);
            z-index: 10;
        }

        /* When carousel is hovered, shrink the active card back to normal */
        .nav-carousel:hover .nav-card.active {
            flex: 1;
            min-height: 420px;
            border-color: rgba(126, 200, 227, 0.25);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            background: rgba(10, 22, 40, 0.9);
            transform: translateY(0);
            z-index: 1;
        }

        /* HOVER STATE - Card expands (including active when hovered directly) */
        .nav-carousel:hover .nav-card:hover,
        .nav-carousel:hover .nav-card.active:hover {
            flex: 2.5;
            min-height: 480px;
            border-color: rgba(126, 200, 227, 0.7);
            box-shadow: 0 24px 70px rgba(0, 0, 0, 0.5), 0 0 50px rgba(126, 200, 227, 0.25);
            background: rgba(10, 22, 40, 0.98);
            transform: translateY(-10px);
            z-index: 10;
        }

        /* Card image */
        .nav-card-image {
            width: 100%;
            height: 180px;
            overflow: hidden;
            flex-shrink: 0;
            transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-card.active .nav-card-image {
            height: 220px;
        }

        .nav-carousel:hover .nav-card.active .nav-card-image {
            height: 180px;
        }

        .nav-carousel:hover .nav-card:hover .nav-card-image {
            height: 220px;
        }

        .nav-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-card.active .nav-card-image img {
            transform: scale(1.1);
        }

        .nav-carousel:hover .nav-card.active .nav-card-image img {
            transform: scale(1);
        }

        .nav-carousel:hover .nav-card:hover .nav-card-image img {
            transform: scale(1.1);
        }

        /* Card content */
        .nav-card-content {
            padding: 24px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            transition: padding 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-card.active .nav-card-content {
            padding: 28px;
        }

        .nav-carousel:hover .nav-card.active .nav-card-content {
            padding: 24px;
        }

        .nav-carousel:hover .nav-card:hover .nav-card-content {
            padding: 28px;
        }

        .nav-card h3 {
            margin: 0 0 12px 0;
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-card.active h3 {
            font-size: 26px;
            margin-bottom: 16px;
        }

        .nav-carousel:hover .nav-card.active h3 {
            font-size: 20px;
            margin-bottom: 12px;
        }

        .nav-carousel:hover .nav-card:hover h3 {
            font-size: 26px;
            margin-bottom: 16px;
        }

        .nav-card p {
            margin: 0;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.5;
            flex-grow: 1;
            overflow: hidden;
            max-height: 65px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-card.active p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 16px;
            line-height: 1.7;
            max-height: 400px;
        }

        .nav-carousel:hover .nav-card.active p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            line-height: 1.5;
            max-height: 65px;
        }

        .nav-carousel:hover .nav-card:hover p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 16px;
            line-height: 1.7;
            max-height: 400px;
        }

        .nav-card-cta {
            font-weight: 600;
            font-size: 14px;
            color: #7ec8e3;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: auto;
            padding-top: 16px;
            opacity: 0.7;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-card.active .nav-card-cta {
            opacity: 1;
            font-size: 17px;
            color: #a8e6cf;
        }

        .nav-carousel:hover .nav-card.active .nav-card-cta {
            opacity: 0.7;
            font-size: 14px;
            color: #7ec8e3;
        }

        .nav-carousel:hover .nav-card:hover .nav-card-cta {
            opacity: 1;
            font-size: 17px;
            color: #a8e6cf;
        }

        .nav-card-cta svg {
            width: 16px;
            height: 16px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-card.active .nav-card-cta svg {
            width: 20px;
            height: 20px;
            transform: translateX(8px);
        }

        .nav-carousel:hover .nav-card.active .nav-card-cta svg {
            width: 16px;
            height: 16px;
            transform: translateX(0);
        }

        .nav-carousel:hover .nav-card:hover .nav-card-cta svg {
            width: 20px;
            height: 20px;
            transform: translateX(8px);
        }

        /* Dots hidden on desktop */
        .carousel-dots {
            display: none;
        }

        /* ============================================
           TABLET BREAKPOINT
           ============================================ */
        @media (max-width: 1100px) {
            .nav-carousel-section {
                padding: 0 24px 100px;
            }

            .nav-section-title {
                font-size: 40px;
            }

            .nav-section-subtitle {
                font-size: 16px;
            }

            .nav-carousel {
                gap: 16px;
            }

            .nav-card {
                min-height: 380px;
            }

            .nav-card.active,
            .nav-card:hover {
                flex: 2;
                min-height: 420px;
            }

            .nav-card-image {
                height: 150px;
            }

            .nav-card.active .nav-card-image,
            .nav-card:hover .nav-card-image {
                height: 180px;
            }

            .nav-card h3 {
                font-size: 18px;
            }

            .nav-card.active h3,
            .nav-card:hover h3 {
                font-size: 22px;
            }

            .nav-card p {
                font-size: 13px;
                max-height: 55px;
            }

            .nav-card.active p,
            .nav-card:hover p {
                font-size: 15px;
            }
        }

        /* ============================================
           MOBILE BREAKPOINT - SWIPEABLE CAROUSEL
           ============================================ */
        @media (max-width: 800px) {
            .nav-carousel-section {
                position: absolute;
                top: 66%;
                left: 0;
                right: 0;
                padding: 0;
            }

            .nav-carousel-wrapper {
                width: 100%;
                padding-bottom: 40px;
            }

            .nav-section-header {
                margin-bottom: 24px;
                padding: 0 24px;
                text-align: center;
            }

            .nav-section-title {
                font-size: 32px;
                margin-bottom: 8px;
            }

            .nav-section-subtitle {
                font-size: 14px;
                line-height: 1.5;
                padding: 0 10px;
            }

            /* Horizontal scrolling carousel */
            .nav-carousel {
                display: flex;
                flex-direction: row;
                flex-wrap: nowrap;
                gap: 16px;
                padding: 0 14%;
                overflow-x: auto;
                overflow-y: hidden;
                scroll-snap-type: x mandatory;
                scroll-behavior: smooth;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .nav-carousel::-webkit-scrollbar {
                display: none;
            }

            /* Reset ALL desktop card states on mobile */
            .nav-card {
                flex: 0 0 72%;
                min-width: 72%;
                max-width: 72%;
                min-height: 380px;
                height: auto;
                scroll-snap-align: center;
                transform: none !important;
                z-index: 1 !important;
                border-radius: 16px;
                background: rgba(10, 22, 40, 0.95);
                border-color: rgba(126, 200, 227, 0.35);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            }

            /* Override active and hover states completely */
            .nav-card.active,
            .nav-card:hover,
            .nav-card:focus,
            .nav-carousel:hover .nav-card,
            .nav-carousel:hover .nav-card.active,
            .nav-carousel:hover .nav-card:hover,
            .nav-carousel:hover .nav-card.active:hover {
                flex: 0 0 72%;
                min-width: 72%;
                max-width: 72%;
                min-height: 380px;
                height: auto;
                transform: none !important;
                z-index: 1 !important;
                border-color: rgba(126, 200, 227, 0.35);
                box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
                background: rgba(10, 22, 40, 0.95);
            }

            /* Card image */
            .nav-card-image,
            .nav-card.active .nav-card-image,
            .nav-card:hover .nav-card-image,
            .nav-carousel:hover .nav-card .nav-card-image,
            .nav-carousel:hover .nav-card:hover .nav-card-image {
                height: 220px;
                border-radius: 16px 16px 0 0;
            }

            .nav-card-image img,
            .nav-card.active .nav-card-image img,
            .nav-card:hover .nav-card-image img,
            .nav-carousel:hover .nav-card .nav-card-image img,
            .nav-carousel:hover .nav-card:hover .nav-card-image img {
                transform: none !important;
            }

            /* Card content */
            .nav-card-content,
            .nav-card.active .nav-card-content,
            .nav-card:hover .nav-card-content,
            .nav-carousel:hover .nav-card .nav-card-content,
            .nav-carousel:hover .nav-card:hover .nav-card-content {
                padding: 18px;
            }

            .nav-card h3,
            .nav-card.active h3,
            .nav-card:hover h3,
            .nav-carousel:hover .nav-card h3,
            .nav-carousel:hover .nav-card:hover h3 {
                font-size: 20px;
                margin-bottom: 10px;
            }

            .nav-card p,
            .nav-card.active p,
            .nav-card:hover p,
            .nav-carousel:hover .nav-card p,
            .nav-carousel:hover .nav-card:hover p {
                font-size: 13px;
                line-height: 1.55;
                max-height: none;
                color: rgba(255, 255, 255, 0.85);
                overflow: visible;
            }

            .nav-card-cta,
            .nav-card.active .nav-card-cta,
            .nav-card:hover .nav-card-cta,
            .nav-carousel:hover .nav-card .nav-card-cta,
            .nav-carousel:hover .nav-card:hover .nav-card-cta {
                font-size: 14px;
                opacity: 1;
                color: #7ec8e3;
                padding-top: 14px;
            }

            .nav-card-cta svg,
            .nav-card.active .nav-card-cta svg,
            .nav-card:hover .nav-card-cta svg,
            .nav-carousel:hover .nav-card .nav-card-cta svg,
            .nav-carousel:hover .nav-card:hover .nav-card-cta svg {
                width: 16px;
                height: 16px;
                transform: none !important;
            }

            /* Carousel dots */
            .carousel-dots {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-top: 20px;
                padding: 0 20px;
            }

            .carousel-dot {
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.3);
                border: none;
                cursor: pointer;
                transition: all 0.25s ease;
                padding: 0;
            }

            .carousel-dot.active {
                background: rgba(255, 255, 255, 0.9);
                transform: scale(1.25);
            }
        }

        /* ============================================
           SMALL MOBILE (phones)
           ============================================ */
        @media (max-width: 480px) {
            .nav-carousel-section {
                top: 64%;
            }

            .nav-section-header {
                margin-bottom: 20px;
                padding: 0 16px;
            }

            .nav-section-title {
                font-size: 28px;
            }

            .nav-section-subtitle {
                font-size: 13px;
            }

            .nav-carousel {
                gap: 14px;
                padding: 0 12%;
            }

            .nav-card,
            .nav-card.active,
            .nav-card:hover,
            .nav-carousel:hover .nav-card,
            .nav-carousel:hover .nav-card.active,
            .nav-carousel:hover .nav-card:hover {
                flex: 0 0 76%;
                min-width: 76%;
                max-width: 76%;
                min-height: 340px;
            }

            .nav-card-image,
            .nav-card.active .nav-card-image,
            .nav-card:hover .nav-card-image,
            .nav-carousel:hover .nav-card .nav-card-image,
            .nav-carousel:hover .nav-card:hover .nav-card-image {
                height: 180px;
            }

            .nav-card-content,
            .nav-card.active .nav-card-content,
            .nav-card:hover .nav-card-content,
            .nav-carousel:hover .nav-card .nav-card-content,
            .nav-carousel:hover .nav-card:hover .nav-card-content {
                padding: 14px;
            }

            .nav-card h3,
            .nav-card.active h3,
            .nav-card:hover h3,
            .nav-carousel:hover .nav-card h3,
            .nav-carousel:hover .nav-card:hover h3 {
                font-size: 18px;
                margin-bottom: 8px;
            }

            .nav-card p,
            .nav-card.active p,
            .nav-card:hover p,
            .nav-carousel:hover .nav-card p,
            .nav-carousel:hover .nav-card:hover p {
                font-size: 12px;
            }

            .nav-card-cta,
            .nav-card.active .nav-card-cta,
            .nav-card:hover .nav-card-cta,
            .nav-carousel:hover .nav-card .nav-card-cta,
            .nav-carousel:hover .nav-card:hover .nav-card-cta {
                font-size: 13px;
                padding-top: 12px;
            }

            .carousel-dots {
                gap: 8px;
                margin-top: 16px;
            }

            .carousel-dot {
                width: 8px;
                height: 8px;
            }
        }

        /* Lock page scroll during intro */
        html.no-scroll,
        body.no-scroll {
            overflow: hidden !important;
            height: 100% !important;
            overscroll-behavior: none;
            touch-action: none;
            }

        /* Video animation styles (when USE_3D_ANIMATION is false) */
        #whaleScene video {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            object-fit: cover;
        }

        #whaleScene.video-mode {
            background: #0a1628;
        }
    </style>
</head>
<body class="page-enter">
    <!-- Navigation Bar -->
    <nav id="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">
                <span class="whale-icon">
                    <img src="favicon.ico" alt="Whale Icon" class="whale-icon-img">
                </span>
                <span class="brand-text">Whale Watchers Atlas</span>
            </a>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                <a href="density-map.html" class="nav-link">Density Map</a>
                <a href="species.html" class="nav-link">Species Map</a>
                <a href="whale-species-gallery.html" class="nav-link">Whale Species</a>
                <a href="whale-locations-gallery.html" class="nav-link">Locations</a>
                <a href="/news.html" class="nav-link">News</a>
                <a href="about.html" class="nav-link">About</a>
            </div>
        </div>
    </nav>
    <!-- Description Section -->
    <!-- <div id="description">
        <h1>Whale Species Diversity & Watching Locations</h1>
        <p>
            This interactive map reveals where different whale species overlap throughout the year,
            combined with <strong>premier whale watching locations</strong> worldwide. This heat map was made from GBIF accumulated whale observations of 9 species: Blue Whale, Sperm Whale, Humpback Whale, Right Whale, Fin Whale, Minke Whale, Beluga Whale, and Grey Whale.
            Navigate to the next page to see the species specific distributions!
            Click the <span style="color: #000000; font-weight: 600;">black POI pins</span> to discover top viewing spots with detailed information.
        </p>
        <p>
            <strong>How to use:</strong> Drag the circular dial to rotate through months, click month labels, or use the arrows. 
            Brighter colors show where multiple species overlap.
        </p>
    </div> -->
    <section id="hero">
    
    <!-- Title -->
    <div class="hero-scene scene-intro">
        <div class="scene-content">
            <h1 class="hero-title-main">
                Whale Watchers
                <span>Atlas</span>
            </h1>
            <p class="hero-tagline">Where giants roam</p>
        </div>
    </div>
    
    <!-- Floating highlight texts -->
    <div class="hero-highlight highlight-1">
        <span class="highlight-label">Explore</span>
        <span class="highlight-text">Real-Time Migration Heatmaps</span>
        <span class="highlight-subtext">Track species movements across oceans with dynamic density visualizations updated by season</span>
    </div>
    
    <div class="hero-highlight highlight-2">
        <span class="highlight-label">Discover</span>
        <span class="highlight-text">In-Depth Species Profiles</span>
        <span class="highlight-subtext">Dive into detailed pages covering behavior, habitat, conservation status, and identification guides</span>
    </div>
    
    <div class="hero-highlight highlight-3">
        <span class="highlight-label">Find</span>
        <span class="highlight-text">World-Class Watching Spots</span>
        <span class="highlight-subtext">Pinpoint the best locations and seasons to witness these magnificent creatures in the wild</span>
    </div>
    
    <!-- Scroll Indicator (only visible at start) -->
    <div class="scroll-indicator" id="scrollIndicator">
        <span>Scroll to explore</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12l7 7 7-7"/>
        </svg>
    </div>
    
    <!-- Whale Animation Scene (3D model or video based on USE_3D_ANIMATION toggle) -->
    <div id="whaleScene" aria-hidden="true">
        <!-- Video element (used when USE_3D_ANIMATION is false) -->
        <video id="whaleVideo" muted playsinline disablePictureInPicture style="display: none;">
            <source src="models/animated_whale.mp4" type="video/mp4">
            <source src="models/animated_whale.webm" type="video/webm">
        </video>
    </div>

    <!-- Navigation Cards -->
    <div class="nav-carousel-section" id="navCarousel">
        <div class="nav-carousel-wrapper">
            <div class="nav-section-header">
                <h2 class="nav-section-title">Explore</h2>
                <p class="nav-section-subtitle">Select from our maps, species gallery or whale watching destinations!</p>
            </div>
            <div class="nav-carousel" id="carouselTrack">
                <a class="nav-card active" href="density-map.html" data-index="0">
                    <div class="nav-card-image">
                        <img src="images/cards/Density.png" alt="Density Map Preview">
                    </div>
                    <div class="nav-card-content">
                        <h3>Density Map</h3>
                        <p>Explore global whale population density through interactive heatmaps. Watch migration patterns shift month by month as different species traverse the world's oceans in search of food and breeding grounds. Data sourced from GBIF observations spanning multiple decades.</p>
                        <span class="nav-card-cta">
                            Launch map
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </span>
                    </div>
                </a>
                <a class="nav-card" href="species.html" data-index="1">
                    <div class="nav-card-image">
                        <img src="images/cards/Species.png" alt="Species Map Preview">
                    </div>
                    <div class="nav-card-content">
                        <h3>Species Map</h3>
                        <p>Track nine major whale species individually with color-coded animated routes. Filter by Blue, Humpback, Sperm, Right, Fin, Minke, Beluga, Gray, and Orca whales to see their unique migration corridors throughout the year.</p>
                        <span class="nav-card-cta">
                            Open tracker
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </span>
                    </div>
                </a>
                <a class="nav-card" href="whale-locations-gallery.html" data-index="2">
                    <div class="nav-card-image">
                        <img src="images/cards/Watching_locations.png" alt="Watching Locations Preview">
                    </div>
                    <div class="nav-card-content">
                        <h3>Watching Locations</h3>
                        <p>Discover the world's premier whale watching destinations. Each location features seasonal guides, best viewing months, species you'll encounter, accessibility ratings, and practical tips for planning your expedition.</p>
                        <span class="nav-card-cta">
                            Browse sites
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </span>
                    </div>
                </a>
                <a class="nav-card" href="whale-species-gallery.html" data-index="3">
                    <div class="nav-card-image">
                        <img src="images/cards/Species_guide.png" alt="Species Guide Preview">
                    </div>
                    <div class="nav-card-content">
                        <h3>Species Guide</h3>
                        <p>Dive deep into detailed profiles covering behavior, physical characteristics, habitats, conservation status, and identification tips for each whale species. Learn about their unique songs, feeding strategies, and social structures.</p>
                        <span class="nav-card-cta">
                            View guide
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14M12 5l7 7-7 7"/>
                            </svg>
                        </span>
                    </div>
                </a>
            </div>
            <!-- Mobile carousel dots -->
            <div class="carousel-dots" id="carouselDots">
                <button class="carousel-dot active" data-index="0" aria-label="Go to card 1"></button>
                <button class="carousel-dot" data-index="1" aria-label="Go to card 2"></button>
                <button class="carousel-dot" data-index="2" aria-label="Go to card 3"></button>
                <button class="carousel-dot" data-index="3" aria-label="Go to card 4"></button>
            </div>
        </div>
    </div>
</section>

    <!-- Whale Animation Controller (supports both 3D and video modes) -->
    <script>
    (function() {
        const hero = document.getElementById('hero');
        const whaleContainer = document.getElementById('whaleScene');
        const whaleVideo = document.getElementById('whaleVideo');
        const scrollIndicator = document.getElementById('scrollIndicator');
        const highlights = document.querySelectorAll('.hero-highlight');

        if (!hero || !whaleContainer) return;

        // ---------------------------
        // Scroll locking helpers
        // ---------------------------
        const SCROLL_KEYS = new Set(['ArrowUp','ArrowDown','PageUp','PageDown','Home','End',' ','Spacebar']);

        function preventScroll(e) { e.preventDefault(); }

        function lockScroll() {
            window.scrollTo(0, 0);
            document.documentElement.classList.add('no-scroll');
            document.body.classList.add('no-scroll');

            window.addEventListener('wheel', preventScroll, { passive: false });
            window.addEventListener('touchmove', preventScroll, { passive: false });
            window.addEventListener('keydown', onKeyDown, { passive: false });
        }

        function unlockScroll() {
            document.documentElement.classList.remove('no-scroll');
            document.body.classList.remove('no-scroll');

            window.removeEventListener('wheel', preventScroll, { passive: false });
            window.removeEventListener('touchmove', preventScroll, { passive: false });
            window.removeEventListener('keydown', onKeyDown, { passive: false });
        }

        function onKeyDown(e) {
            if (SCROLL_KEYS.has(e.key)) e.preventDefault();
        }

        // ---------------------------
        // Shared "apply progress" logic
        // ---------------------------
        const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

        function applyWhaleProgress(progress, whaleScene) {
            progress = clamp(progress, 0, 1);

            // whale only
            whaleScene.setScrollProgress(progress);

            // keep your whale container fade logic if you want it during intro
            let opacity = 1;
            if (progress < 0.03) opacity = progress / 0.03;
            else if (progress > 0.92) opacity = (1 - progress) / 0.08;
            whaleContainer.style.opacity = opacity;
            }

        function applyTextProgress(progress) {
            progress = clamp(progress, 0, 1);

            // Scroll prompt hides once user scrolls a bit
            if (scrollIndicator) {
                if (progress > 0.05) scrollIndicator.classList.add('hidden');
                else scrollIndicator.classList.remove('hidden');
            }

            // Highlight timing (your existing logic, but text-only now)
            highlights.forEach((highlight, index) => {
                const showAt = 0.0 + (index * 0.22);
                const peakAt = showAt + 0.05;
                const fadeAt = showAt + 0.55;
                const hideAt = showAt + 0.85;

                let highlightOpacity = 0;
                if (progress >= showAt && progress < peakAt) {
                highlightOpacity = (progress - showAt) / (peakAt - showAt);
                } else if (progress >= peakAt && progress < fadeAt) {
                highlightOpacity = 1;
                } else if (progress >= fadeAt && progress < hideAt) {
                highlightOpacity = 1 - (progress - fadeAt) / (hideAt - fadeAt);
                }

                highlight.style.opacity = highlightOpacity;
                highlight.style.transform = `translateY(${(1 - highlightOpacity) * 30}px)`;
            });
            }

        function waitForLoaded(whaleScene) {
            return new Promise((resolve) => {
            const tick = () => {
                if (whaleScene && whaleScene.isLoaded) resolve();
                else requestAnimationFrame(tick);
            };
            tick();
            });
        }

        // ---------------------------
        // Intro autoplay for 3D mode (0 -> 1)
        // ---------------------------
        async function playIntro3D(whaleScene) {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
                || window.innerWidth < 768;
            const INTRO_MS = isMobile ? 5000 : 5000;
            const CLIP_START = 0.0;
            const CLIP_END   = 0.37;

            whaleScene.config.clipStart = CLIP_START;
            whaleScene.config.clipEnd = CLIP_END;

            if (scrollIndicator) scrollIndicator.classList.add('hidden');

            lockScroll();
            window.scrollTo(0, 0);

            await waitForLoaded(whaleScene);

            const t0 = performance.now();
            return new Promise((resolve) => {
            const step = (now) => {
                const t = clamp((now - t0) / INTRO_MS, 0, 1);
                const eased = t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t + 2, 3) / 2;

                applyWhaleProgress(eased, whaleScene);

                highlights.forEach(h => {
                    h.style.opacity = 0;
                    h.style.transform = 'translateY(30px)';
                });

                if (t < 1) requestAnimationFrame(step);
                else resolve();
            };
            requestAnimationFrame(step);
            });
        }

        // ---------------------------
        // Intro for video mode
        // ---------------------------
        function playIntroVideo() {
            return new Promise((resolve) => {
                if (!whaleVideo) {
                    resolve();
                    return;
                }

                // Setup video mode
                whaleContainer.classList.add('video-mode');
                whaleVideo.style.display = 'block';
                whaleContainer.style.opacity = 1;

                if (scrollIndicator) scrollIndicator.classList.add('hidden');

                lockScroll();
                window.scrollTo(0, 0);

                // Hide highlights during video
                highlights.forEach(h => {
                    h.style.opacity = 0;
                    h.style.transform = 'translateY(30px)';
                });

                // Play the video
                whaleVideo.play().catch(() => {
                    // Autoplay failed, resolve immediately
                    resolve();
                });

                // When video ends, resolve
                whaleVideo.addEventListener('ended', () => {
                    resolve();
                }, { once: true });

                // Fallback timeout in case video doesn't fire 'ended' event
                whaleVideo.addEventListener('loadedmetadata', () => {
                    const duration = (whaleVideo.duration * 1000) + 500;
                    setTimeout(() => {
                        resolve();
                    }, duration);
                }, { once: true });

                // If video fails to load, resolve after 3 seconds
                whaleVideo.addEventListener('error', () => {
                    setTimeout(resolve, 3000);
                }, { once: true });
            });
        }

        // ---------------------------
        // After intro: enable real scroll driving
        // ---------------------------
        function enableScrollTextDriving() {
            if (scrollIndicator) scrollIndicator.classList.remove('hidden');

            function computeScrollProgress() {
                const rect = hero.getBoundingClientRect();
                const heroHeight = rect.height;
                const viewportHeight = window.innerHeight;
                const scrollDistance = heroHeight - viewportHeight;
                return clamp(-rect.top / scrollDistance, 0, 1);
            }

            let ticking = false;
            function onScroll() {
                if (!ticking) {
                requestAnimationFrame(() => {
                    applyTextProgress(computeScrollProgress());
                    ticking = false;
                });
                ticking = true;
                }
            }

            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('resize', onScroll, { passive: true });

            onScroll();
            }

        // ---------------------------
        // Finish intro and cleanup
        // ---------------------------
        function finishIntro() {
            // Fade out whale container
            whaleContainer.style.transition = 'opacity 0.8s ease';
            whaleContainer.style.opacity = 0;

            // Fully remove from layout after fade
            setTimeout(() => {
                whaleContainer.style.display = 'none';
                if (whaleVideo) {
                    whaleVideo.pause();
                    whaleVideo.src = '';
                }
            }, 800);

            unlockScroll();
            enableScrollTextDriving();
        }

        // ---------------------------
        // Boot - Choose 3D or Video mode
        // ---------------------------
        if (USE_3D_ANIMATION) {
            // 3D Mode: Wait for Three.js to load
            function initWhaleScene() {
                if (typeof THREE === 'undefined' || typeof THREE.GLTFLoader === 'undefined') {
                    setTimeout(initWhaleScene, 100);
                    return;
                }

                const whaleScene = new WhaleScene(whaleContainer, 'models/humpback_whale.glb');
                whaleScene.config.animationName = 'Jump1_Anim';

                playIntro3D(whaleScene).then(() => {
                    whaleScene.setScrollProgress(1);
                    if (whaleScene.dispose) {
                        setTimeout(() => whaleScene.dispose(), 800);
                    }
                    finishIntro();
                });
            }
            initWhaleScene();
        } else {
            // Video Mode: Play the whale video
            playIntroVideo().then(() => {
                finishIntro();
            });
        }
    })();
    </script>

    <!-- Navigation Cards Controller -->
    <script>
    (function() {
        const carousel = document.getElementById('carouselTrack');
        const cards = carousel ? carousel.querySelectorAll('.nav-card') : [];
        const dotsContainer = document.getElementById('carouselDots');
        const dots = dotsContainer ? dotsContainer.querySelectorAll('.carousel-dot') : [];

        if (!carousel || cards.length === 0) return;

        let activeIndex = 0; // Start with first card on mobile
        const isMobile = () => window.innerWidth <= 800;

        function updateDots(index) {
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === index);
            });
        }

        function scrollToCard(index) {
            if (index < 0 || index >= cards.length) return;
            activeIndex = index;
            updateDots(index);

            const card = cards[index];
            const scrollLeft = card.offsetLeft - (carousel.offsetWidth - card.offsetWidth) / 2;
            carousel.scrollTo({ left: scrollLeft, behavior: 'smooth' });
        }

        // Dot navigation (mobile only)
        dots.forEach(dot => {
            dot.addEventListener('click', () => {
                const index = parseInt(dot.dataset.index, 10);
                scrollToCard(index);
            });
        });

        // Mobile: Detect which card is centered on scroll and update dots
        let scrollTimeout;
        carousel.addEventListener('scroll', () => {
            if (!isMobile()) return;

            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const carouselRect = carousel.getBoundingClientRect();
                const carouselCenter = carouselRect.left + carouselRect.width / 2;

                let closestIndex = 0;
                let closestDistance = Infinity;

                cards.forEach((card, i) => {
                    const cardRect = card.getBoundingClientRect();
                    const cardCenter = cardRect.left + cardRect.width / 2;
                    const distance = Math.abs(cardCenter - carouselCenter);

                    if (distance < closestDistance) {
                        closestDistance = distance;
                        closestIndex = i;
                    }
                });

                if (closestIndex !== activeIndex) {
                    activeIndex = closestIndex;
                    updateDots(closestIndex);
                }
            }, 50);
        }, { passive: true });

        // Initialize: scroll to first card on mobile
        if (isMobile()) {
            setTimeout(() => scrollToCard(0), 100);
        }

        // On resize, re-scroll to active card if switching to mobile
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (isMobile()) {
                    scrollToCard(activeIndex);
                }
            }, 100);
        });
    })();
    </script>

    <!-- Mobile nav toggle -->
    <script>
    (function() {
        const navbar = document.getElementById('navbar');
        const toggle = document.getElementById('navToggle');
        if (!navbar || !toggle) return;

        toggle.addEventListener('click', () => {
            navbar.classList.toggle('nav-open');
        });

        navbar.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => navbar.classList.remove('nav-open'));
        });
    })();
    </script>


    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <p class="footer-attribution"><a href="about.html">About</a></p>
        </div>
    </footer>
</body>
</html>
